{% extends "base.html" %}

{% block title %}Makine Bilgilerini Düzelt{% endblock %}

{% block head %}
    {{ super() }}
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; margin: 20px; background-color: #f8f9fa; }
        .container { max-width: 550px; margin: auto; padding: 25px; background-color: #fff; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        h2 { color: #343a40; text-align: center; margin-bottom: 20px;} 
        .form-group { margin-bottom: 0.7rem; }
        label { display: block; margin-bottom: .4rem; font-weight: 500; color: #495057; }
        input.form-control, select.form-control, textarea.form-control { width: 100%; padding: .5rem; border: 1px solid #ced4da; border-radius: .25rem; box-sizing: border-box; font-size: 1rem; font-family: inherit; resize: vertical; }
        .alert { padding: 1rem; margin-bottom: 1rem; border: 1px solid transparent; border-radius: .25rem; }
        .alert-danger { color: #721c24; background-color: #f8d7da; border-color: #f5c6cb; }
        .alert-success { color: #155724; background-color: #d4edda; border-color: #c3e6cb; }
        .butonlar { display: flex; justify-content: flex-start; gap: 40px; margin-top: 30px; }
        .buton { display: inline-block; padding: 10px 10px; background-color: #007BFF; color: white; text-decoration: none; border-radius: 5px; font-weight: bold; border: none; cursor: pointer; transition: background-color 0.3s ease; font-size: 1.1rem; }
        .buton:hover { background-color: #0056b3; }
        .buton.iptal { background-color: #6c757d; }
        .buton.iptal:hover { background-color: #5a6268; }
    </style>
{% endblock %}

{% block content %}
<div class="container">
    <h2>"{{ ekipman.kod }}" Makinesini Düzelt</h2>
    
    <form action="" method="POST" novalidate>
        {{ form.hidden_tag() }} 
        
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}
        
        <div class="form-group">
            {{ form.kod.label(text="Makine Kodu :") }}
            {{ form.kod(class="form-control") }}
            {% for error in form.kod.errors %}<span style="color: red;">[{{ error }}]</span>{% endfor %}
        </div>

        <div class="form-group">
             {{ form.yakit.label(text="Yakıt Tipi :") }}
             {{ form.yakit(id="yakit", class="form-control", list="yakit-listesi") }}
            <datalist id="yakit-listesi">
                <option value="Elektrikli">
                <option value="Dizel">
                <option value="Hybrid"> 
            </datalist>
            {% for error in form.yakit.errors %}<span style="color: red;">[{{ error }}]</span>{% endfor %}
        </div>    

        <div class="form-group">
             {{ form.tipi.label(text="Makine Tipi:") }}
             {{ form.tipi(id="tipi", class="form-control", list="tip-listesi") }}
            <datalist id="tip-listesi">
                <option value="Manlift">
                <option value="Eklemli">
                <option value="Teleskopik sepet">
                <option value="Forklift">   
            </datalist>
            {% for error in form.tipi.errors %}<span style="color: red;">[{{ error }}]</span>{% endfor %}
        </div>

         <div class="form-group">
             {{ form.marka.label(text="Markası :") }}
             {{ form.marka(id="marka", class="form-control", list="marka-listesi") }}
            <datalist id="marka-listesi">
                <option value="Dingli">
                <option value="Sinoboom">
                <option value="Zoomlion">
                <option value="Haulotte">
                <option value="JLG">
                <option value="Genie">
                <option value="Skyjack">
            </datalist>
            {% for error in form.marka.errors %}<span style="color: red;">[{{ error }}]</span>{% endfor %}
        </div>

        <!-- MODEL ALANI -->
        <div class="form-group">
             {{ form.model.label(text="Modeli :") }}
             {{ form.model(id="model", class="form-control") }}
            {% for error in form.model.errors %}<span style="color: red;">[{{ error }}]</span>{% endfor %}
        </div>

       <div class="form-group">
            {{ form.seri_no.label(text="Seri No :") }}   
            {{ form.seri_no(id="seri_no", class="form-control") }}
            {% for error in form.seri_no.errors %}<span style="color: red;">[{{ error }}]</span>{% endfor %}
        </div>

        <div class="form-group">
            {{ form.calisma_yuksekligi.label(text="Çalışma Yüksekliği (m):") }}
            {{ form.calisma_yuksekligi(id="calisma_yuksekligi", class="form-control", type="number", step="1") }}     
            {% for error in form.calisma_yuksekligi.errors %}<span style="color: red;">[{{ error }}]</span>{% endfor %}
        </div>

        <div class="form-group">
            {{ form.kaldirma_kapasitesi.label(text="Kaldırma Kapasitesi (kg):") }}
            {{ form.kaldirma_kapasitesi(id="kaldirma_kapasitesi", class="form-control", type="number") }}
            {% for error in form.kaldirma_kapasitesi.errors %}<span style="color: red;">[{{ error }}]</span>{% endfor %}
        </div>
        
        <div class="form-group">
            {{ form.uretim_tarihi.label(text="Üretim Tarihi (Yıl):") }}
            {{ form.uretim_tarihi(id="uretim_tarihi", class="form-control", type="number", step="1", min="1990") }}
            {% for error in form.uretim_tarihi.errors %}<span style="color: red;">[{{ error }}]</span>{% endfor %}
        </div>

        <fieldset class="form-group" style="border: 1px solid #dee2e6; padding: 1.5rem; margin-top: 20px; border-radius: 5px;">
            <legend style="font-size: 1.2em; font-weight: 500; width: auto; padding: 0 10px; margin-left: 5px;">Makine Maliyeti</legend>
            <div class="row">
                <div class="col-md-8 form-group">
                    {{ form.giris_maliyeti.label(text="Giriş Maliyeti (Satın Alma Fiyatı):") }}
                    
                    <!-- JS Formatlaması kaldırıldı, manuel giriş -->
                    {{ form.giris_maliyeti(class="form-control", placeholder="Örn: 15000 veya 15000,50", id="giris_maliyeti", autocomplete="off") }} 
                    
                    <small style="color: #555; margin-top: 5px; display: block;">
                        Kuruş ayracı olarak <strong>virgül</strong> kullanabilirsiniz (Örn: 15000,50).
                    </small>
                    {% for error in form.giris_maliyeti.errors %}<span style="color: red;">[{{ error }}]</span>{% endfor %}
                </div>
                
                <div class="col-md-4 form-group">
                    {{ form.para_birimi.label(text="Para Birimi:") }}
                    {{ form.para_birimi(class="form-control") }}
                </div>
            </div>
        </fieldset>

        <div class="butonlar">
         {{ form.submit(class="buton", value="Güncelle") }}
         <a href="{{ url_for('filo.index') }}" class="buton iptal">İptal</a>
         </div>
    </form>
</div>

<!-- Sadece Tarih Otomatik Doldurma (Sadeleştirildi) -->
<script>
    const yilInput = document.getElementById('uretim_tarihi');
    // Mevcut bir değer yoksa bugünün yılını koy (düzenlemede değer varsa dokunma)
    if (yilInput && !yilInput.value) { 
        const bugunYil = new Date().getFullYear();
        yilInput.value = bugunYil; 
    }
</script>
{% endblock %}